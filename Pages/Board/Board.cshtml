@page
@model BoardModel

@{
    ViewData["Title"] = "Tablero";
    
}

@section Scripts{
    <script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>"
}

<script>

    jQuery(document).ready( 
    jQuery(function () {
        jQuery(".draggable").draggable({
            revert: "invalid"
        });

        $('.column').droppable({
            accept: '.draggable',
            drop: function (event, ui) {
                var dropped = ui.draggable;
                var droppedOn = $(this);
                $(dropped).detach().css({ top: 0, left: 0 }).appendTo(droppedOn);

                $.ajax({
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    url: "/api/Board/movecard",
                    beforeSend: function (request) {
                        request.setRequestHeader("RequestVerificationToken", $('#RequestVerificationToken').val());
                    },
                    data: JSON.stringify({ cardId: dropped[0].id, columnId: droppedOn[0].id }),
                });
            }
        });
    }));
</script>


<div class="container">
    <div class="row">
        <h3 >Tablero: @Model.Id - @Model.Nombre    </h3>
    </div>

    <div class="row">
        @foreach (var column in Model.Columns)
        {
            <div class="col m4">
                <h3 style="text-align:center">@column.Title</h3> 

                <div class="column" style="min-height: 600px" id="@column.Id">
                    
                    @foreach (var card in column.Cards)
                    {
                        <div class="card draggable blue-grey darken-1 " id="@card.Id">
                            <div class="card-content white-text">
                                <p>@card.Content</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
        
    </div>
</div>